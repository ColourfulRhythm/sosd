{"version":3,"file":"static/js/360.436279b7.chunk.js","mappings":"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","sources":["services/emailService.ts"],"sourcesContent":["import { getBaseUrl } from '../utils/getBaseUrl';\n\ninterface EmailNotificationData {\n  to: string;\n  subject: string;\n  html: string;\n  formId: string;\n  formTitle: string;\n  submissionId: string;\n}\n\ninterface FormSubmission {\n  id: string;\n  formId: string;\n  formTitle: string;\n  formData: Record<string, any>;\n  submittedAt: Date;\n  userAgent?: string;\n  ipAddress?: string;\n}\n\ninterface Form {\n  id: string;\n  title: string;\n  blocks?: Array<{\n    title: string;\n    questions: Array<{\n      id: string;\n      label: string;\n      type: string;\n    }>;\n  }>;\n}\n\nclass EmailService {\n  private baseUrl: string;\n\n  constructor() {\n    this.baseUrl = process.env.REACT_APP_API_URL || 'https://us-central1-adparlaysaas.cloudfunctions.net/api';\n  }\n\n  async sendLeadNotification(\n    userEmail: string,\n    submission: FormSubmission,\n    form: Form\n  ): Promise<void> {\n    try {\n      const subject = `New lead from ${submission.formTitle} - click to view details`;\n      const html = this.generateLeadEmailHTML(submission, form);\n\n      const emailData: EmailNotificationData = {\n        to: userEmail,\n        subject,\n        html,\n        formId: submission.formId,\n        formTitle: submission.formTitle,\n        submissionId: submission.id\n      };\n\n      const response = await fetch(`${this.baseUrl}/notifications/email`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(emailData),\n      });\n\n      if (!response.ok) {\n        throw new Error(`Email notification failed: ${response.statusText}`);\n      }\n\n      const result = await response.json();\n      console.log('Email notification sent successfully:', result);\n    } catch (error) {\n      console.error('Error sending email notification:', error);\n      throw error;\n    }\n  }\n\n  private generateLeadEmailHTML(submission: FormSubmission, form: Form): string {\n    const getQuestionLabel = (questionId: string): string => {\n      if (!form.blocks) return questionId;\n      \n      for (const block of form.blocks) {\n        const question = block.questions?.find(q => q.id === questionId);\n        if (question) return question.label;\n      }\n      return questionId;\n    };\n\n    const formatValue = (value: any): string => {\n      if (typeof value === 'object' && value !== null) {\n        if (value.isFile) {\n          return `ðŸ“Ž ${value.fileName} (${value.fileType})`;\n        }\n        return JSON.stringify(value);\n      }\n      return String(value);\n    };\n\n    const responsesHTML = Object.entries(submission.formData)\n      .map(([key, value]) => {\n        const questionLabel = getQuestionLabel(key);\n        const formattedValue = formatValue(value);\n        return `\n          <tr>\n            <td style=\"padding: 8px; border-bottom: 1px solid #eee; font-weight: 600; color: #374151;\">\n              ${questionLabel}\n            </td>\n            <td style=\"padding: 8px; border-bottom: 1px solid #eee; color: #6b7280;\">\n              ${formattedValue}\n            </td>\n          </tr>\n        `;\n      })\n      .join('');\n\n    return `\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <meta charset=\"utf-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <title>New Lead Notification</title>\n        </head>\n        <body style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #374151; max-width: 600px; margin: 0 auto; padding: 20px;\">\n          <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 12px; margin-bottom: 20px;\">\n            <h1 style=\"color: white; margin: 0; font-size: 24px; font-weight: 600;\">\n              ðŸŽ‰ New Lead Received!\n            </h1>\n            <p style=\"color: rgba(255, 255, 255, 0.9); margin: 8px 0 0 0; font-size: 16px;\">\n              You have a new lead from your form: <strong>${submission.formTitle}</strong>\n            </p>\n          </div>\n\n          <div style=\"background: #f9fafb; padding: 20px; border-radius: 8px; margin-bottom: 20px;\">\n            <h2 style=\"color: #374151; margin: 0 0 16px 0; font-size: 18px; font-weight: 600;\">\n              Lead Details\n            </h2>\n            <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 16px; font-size: 14px;\">\n              <div>\n                <strong style=\"color: #374151;\">Form:</strong><br>\n                <span style=\"color: #6b7280;\">${submission.formTitle}</span>\n              </div>\n              <div>\n                <strong style=\"color: #374151;\">Submitted:</strong><br>\n                <span style=\"color: #6b7280;\">${submission.submittedAt.toLocaleDateString()} at ${submission.submittedAt.toLocaleTimeString()}</span>\n              </div>\n            </div>\n          </div>\n\n          <div style=\"background: white; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;\">\n            <h3 style=\"background: #f3f4f6; margin: 0; padding: 16px; font-size: 16px; font-weight: 600; color: #374151;\">\n              Form Responses\n            </h3>\n            <table style=\"width: 100%; border-collapse: collapse;\">\n              <thead>\n                <tr style=\"background: #f9fafb;\">\n                  <th style=\"padding: 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;\">\n                    Question\n                  </th>\n                  <th style=\"padding: 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;\">\n                    Answer\n                  </th>\n                </tr>\n              </thead>\n              <tbody>\n                ${responsesHTML}\n              </tbody>\n            </table>\n          </div>\n\n          <div style=\"text-align: center; margin-top: 30px; padding: 20px; background: #f0f9ff; border-radius: 8px;\">\n            <p style=\"margin: 0 0 16px 0; color: #1e40af; font-weight: 600;\">\n              View this lead in your dashboard\n            </p>\n            <a href=\"${getBaseUrl()}/responses\" \n               style=\"display: inline-block; background: #3b82f6; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: 600; transition: background-color 0.2s;\">\n              View All Leads\n            </a>\n          </div>\n\n          <div style=\"margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb; text-align: center; color: #9ca3af; font-size: 12px;\">\n            <p style=\"margin: 0;\">\n              This email was sent because you have email notifications enabled for your forms.\n              <br>\n              <a href=\"${getBaseUrl()}/settings\" style=\"color: #3b82f6;\">Manage notification settings</a>\n            </p>\n          </div>\n        </body>\n      </html>\n    `;\n  }\n\n  async sendWelcomeEmail(userEmail: string, userName: string): Promise<void> {\n    try {\n      const subject = 'Welcome to AdParlay - Start Building Your Forms!';\n      const html = this.generateWelcomeEmailHTML(userName);\n\n      const emailData: EmailNotificationData = {\n        to: userEmail,\n        subject,\n        html,\n        formId: 'welcome',\n        formTitle: 'Welcome Email',\n        submissionId: 'welcome-' + Date.now()\n      };\n\n      const response = await fetch(`${this.baseUrl}/notifications/email`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(emailData),\n      });\n\n      if (!response.ok) {\n        throw new Error(`Welcome email failed: ${response.statusText}`);\n      }\n\n      console.log('Welcome email sent successfully');\n    } catch (error) {\n      console.error('Error sending welcome email:', error);\n      // Don't throw error for welcome email as it's not critical\n    }\n  }\n\n  private generateWelcomeEmailHTML(userName: string): string {\n    return `\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <meta charset=\"utf-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <title>Welcome to AdParlay</title>\n        </head>\n        <body style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #374151; max-width: 600px; margin: 0 auto; padding: 20px;\">\n          <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 40px; border-radius: 12px; margin-bottom: 30px; text-align: center;\">\n            <h1 style=\"color: white; margin: 0; font-size: 28px; font-weight: 600;\">\n              Welcome to AdParlay! ðŸŽ‰\n            </h1>\n            <p style=\"color: rgba(255, 255, 255, 0.9); margin: 12px 0 0 0; font-size: 18px;\">\n              Hi ${userName}, you're all set to start building amazing forms!\n            </p>\n          </div>\n\n          <div style=\"background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 30px; margin-bottom: 20px;\">\n            <h2 style=\"color: #374151; margin: 0 0 20px 0; font-size: 20px; font-weight: 600;\">\n              What's Next?\n            </h2>\n            <div style=\"space-y: 16px;\">\n              <div style=\"margin-bottom: 16px;\">\n                <h3 style=\"color: #3b82f6; margin: 0 0 8px 0; font-size: 16px; font-weight: 600;\">\n                  1. Create Your First Form\n                </h3>\n                <p style=\"margin: 0; color: #6b7280;\">\n                  Use our drag-and-drop builder to create professional forms in minutes.\n                </p>\n              </div>\n              <div style=\"margin-bottom: 16px;\">\n                <h3 style=\"color: #3b82f6; margin: 0 0 8px 0; font-size: 16px; font-weight: 600;\">\n                  2. Customize & Brand\n                </h3>\n                <p style=\"margin: 0; color: #6b7280;\">\n                  Match your brand colors, fonts, and styling to create a seamless experience.\n                </p>\n              </div>\n              <div style=\"margin-bottom: 16px;\">\n                <h3 style=\"color: #3b82f6; margin: 0 0 8px 0; font-size: 16px; font-weight: 600;\">\n                  3. Share & Collect Leads\n                </h3>\n                <p style=\"margin: 0; color: #6b7280;\">\n                  Get a shareable link and start collecting leads immediately.\n                </p>\n              </div>\n            </div>\n          </div>\n\n          <div style=\"text-align: center; margin: 30px 0;\">\n            <a href=\"${getBaseUrl()}/builder\" \n               style=\"display: inline-block; background: #3b82f6; color: white; padding: 16px 32px; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 16px; transition: background-color 0.2s;\">\n              Start Building Your First Form\n            </a>\n          </div>\n\n          <div style=\"background: #f0f9ff; padding: 20px; border-radius: 8px; margin-top: 30px;\">\n            <h3 style=\"color: #1e40af; margin: 0 0 12px 0; font-size: 16px; font-weight: 600;\">\n              Need Help?\n            </h3>\n            <p style=\"margin: 0 0 12px 0; color: #1e40af;\">\n              Check out our documentation or reach out to our support team.\n            </p>\n            <a href=\"${getBaseUrl()}/help\" style=\"color: #3b82f6; text-decoration: none;\">\n              Visit Help Center â†’\n            </a>\n          </div>\n\n          <div style=\"margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb; text-align: center; color: #9ca3af; font-size: 12px;\">\n            <p style=\"margin: 0;\">\n              You're receiving this email because you signed up for AdParlay.\n              <br>\n              <a href=\"${getBaseUrl()}/settings\" style=\"color: #3b82f6;\">Manage your email preferences</a>\n            </p>\n          </div>\n        </body>\n      </html>\n    `;\n  }\n}\n\nexport const emailService = new EmailService();\nexport default emailService;\n"],"names":["emailService","constructor","baseUrl","this","process","REACT_APP_API_URL","sendLeadNotification","userEmail","submission","form","subject","concat","formTitle","emailData","to","html","generateLeadEmailHTML","formId","submissionId","id","response","fetch","method","headers","body","JSON","stringify","ok","Error","statusText","result","json","console","log","error","responsesHTML","Object","entries","formData","map","_ref","key","value","questionLabel","questionId","blocks","block","_block$questions","question","questions","find","q","label","getQuestionLabel","formattedValue","isFile","fileName","fileType","String","formatValue","join","submittedAt","toLocaleDateString","toLocaleTimeString","getBaseUrl","sendWelcomeEmail","userName","generateWelcomeEmailHTML","Date","now"],"sourceRoot":""}